<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.clxk.electro.dao.ProductDao">
    <sql id="product_field">
        ${pre}.pid as "pid",
        ${pre}.pname as "pname",
        ${pre}.category_id as "categoryId",
        ${pre}.price as "price",
        ${pre}.firstcost as "firstcost",
        ${pre}.discount as "discount",
        ${pre}.stock as "stock",
        ${pre}.date as "date"
    </sql>

    <resultMap id="productMap" type="com.clxk.electro.model.Product">
        <id property="pid" column="pid"/>
        <result property="pname" column="pname"/>
        <result property="categoryId" column="category_id"/>
        <result property="price" column="price"/>
        <result property="firstcost" column="firstcost"/>
        <result property="discount" column="discount"/>
        <result property="stock" column="stock"/>
        <result property="date" column="date"/>
    </resultMap>

    <insert id="insert" parameterType="com.clxk.electro.model.Product">
        insert into product(pid, pname, category_id, price, firstcost, discount, stock, date) values(#{pid}, #{pname}, #{categoryId}, #{price}, #{firstcost},#{discount}, #{stock}, #{date});
    </insert>

    <update id="update" parameterType="com.clxk.electro.model.Product">
        update product
        <set>
            <choose>
                <when test="pname != null and pname != ''">
                    pname = #{pname},
                </when>
                <when test="category_id != null and category_id != ''">
                    category_id = #{categoryId},
                </when>
                <when test="price != null and price != ''">
                    price = #{price},
                </when>
                <when test="firstcost != null and firstcost != ''">
                    firstcost = #{firstcost},
                </when>
                <when test="discount != null and discount != ''">
                    discount = #{discount},
                </when>
                <when test="stock != null and stock != ''">
                    stock = #{stock},
                </when>
                <when test="date != null and date != ''">
                    date = #{date},
                </when>
            </choose>
        </set>
        where pid = #{pid}
    </update>

    <select id="findAll" resultMap="productMap">
        select * from product
    </select>

    <select id="findByPid" parameterType="String" resultMap="productMap">
        select * from product
        where pid = #{pid}
    </select>

    <select id="findByCategory" parameterType="String" resultMap="productMap">
        select * from product
        where category_id = #{categoryId}
    </select>
</mapper>